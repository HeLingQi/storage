var DP={versions:function(){var u=navigator.userAgent,app=navigator.appVersion;return{trident:u.indexOf("Trident")>-1,presto:u.indexOf("Presto")>-1,webKit:u.indexOf("AppleWebKit")>-1,gecko:u.indexOf("Gecko")>-1&&-1==u.indexOf("KHTML"),mobile:!!u.match(/AppleWebKit.*Mobile.*/),ios:!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:u.indexOf("Android")>-1||u.indexOf("Adr")>-1,iPhone:u.indexOf("iPhone")>-1,iPad:u.indexOf("iPad")>-1,webApp:-1==u.indexOf("Safari"),weixin:u.indexOf("MicroMessenger")>-1,qq:" qq"==u.match(/\sQQ/i)}}(),start:function(){$.ajax({method:"GET",url:"//lab.helingqi.com/dmku/api",dataType:"json",success:function(e){DP.waittime=e.data.waittime,DP.ads=e.data.ads,config.logo=e.data.logo,up.pbgjz=e.data.pbgjz,config.sendtime=e.data.sendtime,config.color=e.data.color,config.group_x=DP.ads.set.group,config.dmrule=e.data.dmrule,danmuon=e.data.danmuon,config.group<config.group_x&&"on"==DP.ads.state&&""!=config.group?"1"==DP.ads.set.state?DP.MYad.vod(DP.ads.set.vod.url,DP.ads.set.vod.link):"2"==DP.ads.set.state&&DP.MYad.pic(DP.ads.set.pic.link,DP.ads.set.pic.time,DP.ads.set.pic.img):DP.play(config.url)}})},play:function(url){danmuon?DP.player.dmplay(url):DP.player.play(url),$((function(){$(".mplayer-setting-speeds,.mplayer-setting-speed-item").on("click",(function(){$(".speed-stting").toggleClass("speed-stting-open")})),$(".speed-stting .mplayer-setting-speed-item").on("click",(function(e){$(".mplayer-setting-speeds  .title").text($(this).text())}))})),$(".mplayer-fulloff-icon").on("click",(function(){DP.dp.fullScreen.cancel()})),$(".mplayer-showing").on("click",(function(){DP.dp.play(),$(".vod-pic").remove()})),""!=config.title&&$("#vodtitle").html(config.title+"  "+config.sid)},dmid:function(){0==up.diyid[0]&&""!=config.id?(a=config.id,b=config.sid):1!=up.diyid[0]&&config.id||(a=up.diyid[1],b=up.diyid[2]),DP.id=a+" P"+b},load:function(){if(setTimeout((function(){$("#link1").show()}),100),setTimeout((function(){$("#link1-success").show()}),500),setTimeout((function(){$("#link2").show()}),1e3),setTimeout((function(){$("#link3").show()}),2e3),DP.versions.weixin&&(DP.versions.ios||DP.versions.iPad)){var css='<style type="text/css">';css+="#loading-box{display: none;}",css+="</style>",$("body").append(css).addClass("")}DP.danmu.send(),DP.danmu.list(),DP.def(),DP.dp.danmaku.opacity(1)},def:function(){DP.stime=0,DP.headt=FUNC.get("headt")?FUNC.get("headt"):0,DP.lastt=FUNC.get("lastt")?FUNC.get("lastt"):0,DP.last_tip=parseInt(DP.lastt)+10,DP.frists=FUNC.get("frists"),DP.lasts=FUNC.get("lasts"),DP.playtime=Number(DP.getCookie("time_"+config.url)),DP.ctime=DP.formatTime(DP.playtime),DP.dp.on("loadedmetadata",(function(){DP.loadedmetadataHandler()})),DP.dp.on("ended",(function(){DP.endedHandler()})),DP.dp.on("pause",(function(){DP.MYad.pause.play(DP.ads.pause.link,DP.ads.pause.pic)})),DP.dp.on("play",(function(){DP.MYad.pause.out()})),DP.dp.on("timeupdate",(function(e){DP.timeupdateHandler()})),DP.jump.def()},video:{play:function(){$("#link3").text("视频已准备就绪，即将为您播放"),setTimeout((function(){DP.dp.play(),$("#loading-box").remove(),DP.jump.head()}),1500)},next:function(){top.location.href=up.mylink+config.next},seek:function(){DP.dp.seek(DP.playtime)},end:function(){DP.dp.notice("播放结束啦=。=")},con_play:function(){if(danmuon){var conplayer=` <e>已播放至${DP.ctime}，继续上次播放？</e><d class="conplay-jump">是 <i id="num">${DP.waittime}</i>s</d><d class="conplaying">否</d>`;$("#link3").html(conplayer);var span=document.getElementById("num"),num=span.innerHTML,timer=null;setTimeout((function(){timer=setInterval((function(){num--,span.innerHTML=num,0==num&&(clearInterval(timer),DP.video.seek(),DP.dp.play(),$(".memory-play-wrap,#loading-box").remove())}),1e3)}),1)}else DP.jump.head();var cplayer=`<div class="memory-play-wrap"><div class="memory-play"><span class="close">×</span><span>上次看到 </span><span>${DP.ctime}</span><span class="play-jump">跳转播放</span></div></div>`;$(".mplayer-cplayer").append(cplayer),$(".close").on("click",(function(){$(".memory-play-wrap").remove()})),setTimeout((function(){$(".memory-play-wrap").remove()}),2e4),$(".conplaying").on("click",(function(){clearTimeout(timer),$("#loading-box").remove(),DP.dp.play(),DP.jump.head()})),$(".conplay-jump,.play-jump").on("click",(function(){clearTimeout(timer),DP.video.seek(),$(".memory-play-wrap,#loading-box").remove(),DP.dp.play()}))}},jump:{def:function(){function er(){DP.dp.notice("请输入有效时间哟！")}function su(){DP.dp.notice("设置完成，将在刷新或下一集生效")}function a(b,c,d,e,g,t){$(b).on("click",(function(){o=$(t).val(),o>0?($(b).toggleClass("checked"),su(),g=$(t).val(),FUNC.set(e,g)):er()})),1==d?($(b).addClass("checked"),$(b).on("click",(function(){o=$(t).val(),o>0?FUNC.set(c,0):er()}))):$(b).on("click",(function(e){o=$(t).val(),o>0?FUNC.set(c,1):er()}))}h=".mplayer-setting-jfrist label",l=".mplayer-setting-jlast label",f="#fristtime",j="#jumptime",a(h,"frists",DP.frists,"headt",DP.headt,f),a(l,"lasts",DP.lasts,"lastt",DP.lastt,j),$(f).attr({value:DP.headt}),$(j).attr({value:DP.lastt}),DP.jump.last()},head:function(){DP.stime>DP.playtime&&(DP.playtime=DP.stime),1==DP.frists&&(DP.headt>DP.playtime||0==DP.playtime?DP.jump_f=1:DP.jump_f=0),1==DP.jump_f&&(DP.dp.seek(DP.headt),DP.dp.notice("已为您跳过片头"))},last:function(){""!=config.next?1==DP.lasts&&setInterval((function(){var e=DP.dp.video.duration-DP.dp.video.currentTime;e<DP.last_tip&&DP.dp.notice("即将为您跳过片尾"),DP.lastt>0&&e<DP.lastt&&(DP.setCookie("time_"+config.id,"",-1),DP.video.next())}),1e3):$(".icon-xj").remove()},ad:function(a,b){}},danmu:{send:function(){g=$(".yzm-mplayer-send-icon"),d=$("#dmtext"),h=".mplayer-comment-setting-",$(h+"color input").on("click",(function(){r=$(this).attr("value"),setTimeout((function(){d.css({color:r})}),100)})),$(h+"type input").on("click",(function(){t=$(this).attr("value"),setTimeout((function(){d.attr("dmtype",t)}),100)})),$(h+"font input").on("click",(function(){t=$(this).attr("value"),setTimeout((function(){d.attr("size",t)}),100)})),g.on("click",(function(){a=document.getElementById("dmtext"),a=a.value,b=d.attr("dmtype"),c=d.css("color"),z=d.attr("size");for(var i=0;i<up.pbgjz.length;i++)if(-1!=a.search(up.pbgjz[i]))return void DP.dp.notice("请勿发送无意义内容，规范您的弹幕内容");if(a.length<1)DP.dp.notice("要输入弹幕内容啊喂！");else{var e=Date.parse(new Date),f;e-FUNC.get("dmsent",e)<1e3*config.sendtime?DP.dp.notice("请勿频繁操作！发送弹幕需间隔"+config.sendtime+"秒~"):(d.val(""),DP.dp.danmaku.send({text:a,color:c,type:b,size:z}),FUNC.set("dmsent",e))}})),$(d).on("keydown",(function(event){var e;13==(event||window.event).keyCode&&g.trigger("click")}))},list:function(){$(".mplayer-list-icon,.yzm-mplayer-send-icon").on("click",(function(){$(".list-show").empty(),$.ajax({method:"GET",url:"//lab.helingqi.com/online?cid="+config.id,dataType:"json",success:function(res){1===res.code&&$(".mplayer-watching-number").text(res.res.count)}}),$.ajax({method:"GET",url:config.api+"?ac=get&id="+DP.id,dataType:"json",success:function(d){23==d.code&&(a=d.danmuku,b=d.name,c=d.danum,$(".danmuku-num").text(c),$.each(a,(function(index,item){l=`<d class="danmuku-list" time="${item[0]}"><li>${DP.formatTime(item[0])}</li><li title="${item[4]}">${item[4]}</li><li title="用户：${item[3]}">${item[6]}</li><li class="report" onclick="DP.danmu.report('${item[5]}','${b}','${item[4]}','${item[3]}')">举报</li></d>`,$(".list-show").append(l)}))),$(".danmuku-list").on("dblclick",(function(){DP.dp.seek($(this).attr("time"))}))}})}));var liyih='<div class="dmrules"><a target="_blank" href="'+config.dmrule+'">弹幕礼仪 </a></div>';function add(div1,div2,div3,div4){$(div1).on("click",(function(e){$(div2).toggleClass(div3),$(div4).remove()}))}$("div.mplayer-comment-box").last().append(liyih),add(".mplayer-list-icon",".mplayer-danmu","show")},report:function(a,b,c,d){layer.confirm(c+'\x3c!--br><br><span style="color:#333">请选择需要举报的类型</span--\x3e',{anim:1,title:"举报弹幕",btn:["违法违禁","色情低俗","恶意刷屏","赌博诈骗","人身攻击","侵犯隐私","垃圾广告","剧透","引战"],btn3:function(index,layero){DP.danmu.post_r(a,b,c,d,"恶意刷屏")},btn4:function(index,layero){DP.danmu.post_r(a,b,c,d,"赌博诈骗")},btn5:function(index,layero){DP.danmu.post_r(a,b,c,d,"人身攻击")},btn6:function(index,layero){DP.danmu.post_r(a,b,c,d,"侵犯隐私")},btn7:function(index,layero){DP.danmu.post_r(a,b,c,d,"垃圾广告")},btn8:function(index,layero){DP.danmu.post_r(a,b,c,d,"剧透")},btn9:function(index,layero){DP.danmu.post_r(a,b,c,d,"引战")}},(function(index,layero){DP.danmu.post_r(a,b,c,d,"违法违禁")}),(function(index){DP.danmu.post_r(a,b,c,d,"色情低俗")}))},post_r:function(a,b,c,d,type){$.ajax({type:"get",url:config.api+"?ac=report&cid="+d+"&user="+a+"&type="+type+"&title="+b+"&text="+c,cache:!1,dataType:"json",beforeSend:function(){},success:function(data){DP.dp.notice("举报成功！感谢您为守护弹幕作出了贡献")},error:function(data){var msg="服务故障 or 网络异常，稍后再试6！";DP.dp.notice(msg)}})}},setCookie:function(c_name,value,expireHours){var exdate=new Date;exdate.setHours(exdate.getHours()+expireHours),document.cookie=c_name+"="+escape(value)+(null===expireHours?"":";expires="+exdate.toGMTString())},getCookie:function(c_name){return document.cookie.length>0&&(c_start=document.cookie.indexOf(c_name+"="),-1!==c_start)?(c_start=c_start+c_name.length+1,c_end=document.cookie.indexOf(";",c_start),-1===c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""},formatTime:function(seconds){return[parseInt(seconds/60/60),parseInt(seconds/60%60),parseInt(seconds%60)].join(":").replace(/\b(\d)\b/g,"0$1")},loadedmetadataHandler:function(){DP.playtime>0&&DP.dp.video.currentTime<DP.playtime?setTimeout((function(){DP.video.con_play()}),1e3):setTimeout((function(){danmuon?(DP.dp.notice("视频已准备就绪，即将为您播放"),DP.video.play()):DP.jump.head()}),1e3),DP.dp.on("timeupdate",(function(){DP.timeupdateHandler()}))},timeupdateHandler:function(){DP.setCookie("time_"+config.id,DP.dp.video.currentTime,24)},endedHandler:function(){DP.setCookie("time_"+config.id,"",-1),""!=config.next?(DP.dp.notice("5s后,将自动为您播放下一集"),setTimeout((function(){DP.video.next()}),5e3)):(DP.dp.notice("视频播放已结束"),setTimeout((function(){DP.video.end()}),2e3))},player:{play:function(url){$("body").addClass("danmu-off"),DP.dp=new mplayer({autoplay:!0,element:document.getElementById("player"),theme:config.color,logo:config.logo,video:{url:url,pic:config.pic,type:"auto"}});var css='<style type="text/css">';css+="#loading-box{display: none;}",css+="</style>",$("body").append(css).addClass(""),DP.def()},adplay:function(url){$("body").addClass("danmu-off"),DP.ad=new mplayer({autoplay:!0,element:document.getElementById("ADplayer"),theme:config.color,logo:config.logo,video:{url:url,pic:config.pic,type:"auto"}}),$(".mplayer-controller,.mplayer-cplayer,.mplayer-logo,#loading-box,.mplayer-controller-mask").remove(),$(".mplayer-mask").show(),DP.ad.on("timeupdate",(function(){DP.ad.video.currentTime>DP.ad.video.duration-.1&&($("body").removeClass("danmu-off"),DP.ad.destroy(),$("#ADplayer").remove(),$("#ADtip").remove(),DP.play(config.url))}))},dmplay:function(url){DP.dmid(),DP.dp=new mplayer({autoplay:!1,element:document.getElementById("player"),theme:config.color,logo:config.logo,video:{url:url,pic:config.pic,type:"auto"},danmaku:{id:DP.id,api:config.api+"?ac=dm",user:config.user}}),DP.load()}},MYad:{vod:function(u,l){$("#ADtip").html('<a id="link" href="'+l+'" target="_blank">查看详情</a>'),$("#ADplayer").click((function(){document.getElementById("link").click()})),DP.player.adplay(u)},pic:function(l,t,p){$("#ADtip").html('<a id="link" href="'+l+'" target="_blank">广告 <e id="time_ad">'+t+'</e></a><img src="'+p+'">'),$("#ADtip").click((function(){document.getElementById("link").click()}));var span=document.getElementById("time_ad"),num=span.innerHTML,timer=null;setTimeout((function(){timer=setInterval((function(){num--,span.innerHTML=num,0==num&&(clearInterval(timer),DP.play(config.url),$("#ADtip").remove())}),1e3)}),1)},pause:{play:function(l,p){if("on"==DP.ads.pause.state){var pause_ad_html='<div id="player_pause"><div class="tip">广告</div><a href="'+l+'" target="_blank"><img src="'+p+'"></a></div>';$("#player").before(pause_ad_html)}},out:function(){$("#player_pause").remove()}}}};