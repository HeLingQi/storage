var dmid=diyid,dmsid=diysid;if(laoding>0);else{var css='<style type="text/css">';css+="#loading-box{display: none;}",css+="</style>",$("body").append(css).addClass("")}if(danmuon>0)var dp=new xplayer({autoplay:autoplay,element:document.getElementById("player"),theme:color,logo:logo,video:{url:vodurl,pic:vodpic,type:"auto"},danmaku:{id:dmid,api:dmapi,user:user}});else{$("body").addClass("danmu-off");var dp=new xplayer({autoplay:autoplay,element:document.getElementById("player"),theme:color,logo:logo,video:{url:vodurl,pic:vodpic,type:"auto"}})}function add(div1,div2,div3,div4){$(div1).click((function(){$(div2).toggleClass(div3),$(div4).remove()}))}function formatTime(seconds){return[parseInt(seconds/60/60),parseInt(seconds/60%60),parseInt(seconds%60)].join(":").replace(/\b(\d)\b/g,"0$1")}function setCookie(c_name,value,expireHours){var exdate=new Date;exdate.setHours(exdate.getHours()+expireHours),document.cookie=c_name+"="+escape(value)+(null===expireHours?"":";expires="+exdate.toGMTString())}function getCookie(c_name){return document.cookie.length>0&&(c_start=document.cookie.indexOf(c_name+"="),-1!==c_start)?(c_start=c_start+c_name.length+1,c_end=document.cookie.indexOf(";",c_start),-1===c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}add(".xplayer-list-icon",".xplayer-danmu","show"),dp.on("loadedmetadata",(function(){loadedmetadataHandler()})),dp.on("ended",(function(){endedHandler()}));var playtime=Number(getCookie("time_"+vodurl)),ctime=formatTime(playtime);function loadedmetadataHandler(){playtime>0&&dp.video.currentTime<playtime?setTimeout((function(){video_con_play()}),1e3):(dp.notice("视频已准备就绪，即将为您播放"),setTimeout((function(){video_play()}),1e3)),dp.on("timeupdate",(function(){timeupdateHandler()}))}function timeupdateHandler(){setCookie("time_"+vodurl,dp.video.currentTime,24)}function endedHandler(){setCookie("time_"+vodurl,"",-1),""!=next?(dp.notice("5s后,将自动为您播放下一集"),setTimeout((function(){video_next()}),5e3)):(dp.notice("视频播放已结束"),setTimeout((function(){video_end()}),2e3))}function video_next(){top.location.href=playnext}function video_seek(){dp.seek(playtime)}function video_play(){$("#link3").text("视频已准备就绪，即将为您播放"),setTimeout((function(){dp.play(),$("#loading-box").remove()}),1500)}function video_con_play(){if(laoding>0){var conplayer=` <e>已播放至${ctime}，继续上次播放？</e><d class="conplay-jump">是 <i id="num">10</i>s</d><d class="conplaying">否</d>`;$("#link3").html(conplayer);var span=document.getElementById("num"),num=span.innerHTML,timer=null;setTimeout((function(){timer=setInterval((function(){num--,span.innerHTML=num,0==num&&(clearInterval(timer),video_seek(),dp.play(),$("#laoding-pic,.memory-play-wrap,#loading-box").remove())}),1e3)}),1)}else dp.play();var cplayer=`<div class="memory-play-wrap"><div class="memory-play"><span class="close">×</span><span>上次看到 </span><span>${ctime}</span><span class="play-jump">跳转播放</span></div></div>`;$(".xplayer-cplayer").append(cplayer),$(".close").on("click",(function(){$(".memory-play-wrap").remove()})),setTimeout((function(){$(".memory-play-wrap").remove()}),2e4),$(".conplaying").on("click",(function(){clearTimeout(timer),$("#laoding-pic,#loading-box").remove(),dp.play()})),$(".conplay-jump,.play-jump").on("click",(function(){clearTimeout(timer),video_seek(),$("#laoding-pic,.memory-play-wrap,#loading-box").remove(),dp.play()}))}""!=next||$(".icon-xj").remove(),$(".xplayer-showing").on("click",(function(){dp.play(),$(".vod-pic").remove()})),$(".xplayer-comment-setting-color input").on("click",(function(){var textcolor=$(this).attr("value");setTimeout((function(){$(".yzm-xplayer-comment-input").css({color:textcolor})}),100)})),$(".xplayer-comment-setting-type input").on("click",(function(){var texttype=$(this).attr("value");setTimeout((function(){$(".yzm-xplayer-comment-input").attr("dmtype",texttype)}),100)})),$("#dmset").on("click",(function(){$(".xplayer-comment-icon").trigger("click"),$(".xplayer-comment-setting-box").toggleClass("xplayer-comment-setting-open"),$("#xplayer").toggleClass("xplayer-hide-controller")})),$(".yzm-xplayer-send-icon").on("click",(function(){var inputtext,sendtexts=document.getElementById("dmtext").value,sendtype=$(".yzm-xplayer-comment-input").attr("dmtype"),sendcolor=$(".xplayer-comment-input").css("color"),sendtext=sendtexts.replace(new RegExp(pbgjz.join("|"),"img"),"*");sendtext.length<1?dp.notice("要输入弹幕内容啊喂！"):(dp.danmaku.send({text:sendtext,color:sendcolor,type:sendtype}),$(".yzm-xplayer-comment-input").val(""))})),dp.danmaku.opacity(1),$(".xplayer-list-icon,.yzm-xplayer-send-icon").on("click",(function(){$(".list-show").empty(),$.ajax({url:dmapi+"?id="+dmid,success:function(data){if(0==data.code){var danmaku=data.danmaku;$(".danmuku-num").text(danmaku.length),$(danmaku).each((function(index,item){var dammulist=`<d class="danmuku-list" time="${item[0]}"><li>${formatTime(item[0])}</li><li title="${item[4]}">${item[4]}</li><li title="IP地址：${item[5]}">${item[5]}</li></d>`;$(".list-show").append(dammulist)}))}$(".danmuku-list").on("click",(function(){dp.seek($(this).attr("time"))}))}})})),setTimeout((function(){$("#link1").fadeIn()}),500),setTimeout((function(){$("#link2").fadeIn()}),1e3),setTimeout((function(){$("#link3,#span").fadeIn()}),2e3),$(".xplayer-fulloff-icon").on("click",(function(){dp.fullScreen.cancel()}));